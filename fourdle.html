<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fourdle ‚Äì 4-Letter Word Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="common.css" />
  <script src="activity-logger.js"></script>
  <style>
    .game { max-width: 480px; }
    .board {
      grid-template-columns: repeat(4, 1fr);
      max-width: 360px;
      gap: 0.35rem;
    }
    .tile { font-size: 2rem; }
    .keyboard { max-width: 480px; }
    @media (max-width: 480px) {
      .tile { font-size: 1.6rem; }
    }
  </style>
</head>
<body>
  <div class="game">
    <header>
      <a href="index.html" class="home-link" title="Back to games (H)">üè†</a>
      <h1>Fourdle</h1>
      <small>Guess the four-letter British English word in six tries</small>
    </header>

    <main>
      <div id="board" class="board" aria-label="Game board"></div>
      <div id="message" class="message" aria-live="polite"></div>
      <div id="keyboard" class="keyboard" aria-label="On-screen keyboard"></div>
      <button id="new-game" type="button">New game</button>
      <div class="keyboard-hints">
        <span><span class="key-hint">Enter</span> Submit</span>
        <span><span class="key-hint">‚å´</span> Delete</span>
        <span><span class="key-hint">N</span> New game*</span>
        <span><span class="key-hint">H</span> Home*</span>
        <span style="width:100%;text-align:center;font-size:0.6rem;">*after game ends</span>
      </div>
      <div id="word-info" class="word-info" aria-live="polite"></div>
    </main>
  </div>

  <script>
    // British English 4-letter words from Hunspell en_GB dictionary (2291 words)
    const WORD_LIST = [
      "ABAC","ABBA","ABBE","ABBR","ABET","ABLE","ABUT","ABYE","ACHE","ACHY","ACID","ACME",
      "ACNE","ACRE","ACTA","ACYL","ADIT","ADZE","AEON","AERO","AFRO","AGAR","AGBA","AGED",
      "AGIO","AGUE","AHEM","AHOY","AIDE","AIRY","AKEE","ALAS","ALBA","ALGA","ALLY","ALMS",
      "ALOE","ALTO","ALUM","AMEN","AMIR","AMMO","AMYL","ANAL","ANKH","ANON","ANTE","ANTI",
      "ANUS","APEX","APSE","AQUA","ARCH","ARCO","AREA","ARIA","ARID","ARIL","ARMS","ARMY",
      "ARSE","ARTY","ARUM","ARYL","ASHY","ATOM","AUNT","AURA","AUTH","AUTO","AVER","AVID",
      "AVOW","AWRY","AXEL","AXIL","AXIS","AXLE","AXON","AYAH","BABA","BABE","BABY","BACH",
      "BACK","BAHT","BAIL","BAIT","BAKE","BALD","BALE","BALK","BALL","BALM","BAND","BANE",
      "BANG","BANK","BARB","BARD","BARE","BARF","BARK","BARN","BASE","BASH","BASK","BASS",
      "BAST","BATE","BATH","BATS","BATT","BAUD","BAWD","BAWL","BAWN","BAYA","BAZA","BEAD",
      "BEAK","BEAM","BEAN","BEAR","BEAT","BEAU","BECK","BEEF","BEEP","BEET","BELL","BELT",
      "BELY","BEMA","BEND","BERG","BERK","BERM","BEST","BETA","BEVY","BIAS","BIDE","BIDS",
      "BIER","BIFF","BIKE","BILE","BILK","BILL","BIND","BINE","BING","BINT","BIOG","BIOL",
      "BION","BIRD","BITE","BLAB","BLAG","BLAH","BLAT","BLDG","BLEB","BLIP","BLOB","BLOC",
      "BLOG","BLOT","BLOW","BLUB","BLUE","BLUR","BOAR","BOAT","BOCK","BODE","BODY","BOFF",
      "BOID","BOIL","BOLA","BOLD","BOLE","BOLL","BOLT","BOMB","BOND","BONE","BONG","BONK",
      "BONY","BOOB","BOOK","BOOM","BOON","BOOR","BOOT","BORE","BORK","BORN","BOSH","BOSS",
      "BOTH","BOUT","BOWL","BOXY","BOYO","BOZO","BRAD","BRAE","BRAG","BRAN","BRAS","BRAT",
      "BRAY","BREW","BRIC","BRIG","BRIM","BRIO","BROW","BRUV","BUBO","BUCK","BUDO","BUFF",
      "BULB","BULK","BULL","BUMF","BUMP","BUNG","BUNK","BUNT","BUOY","BURB","BURG","BURL",
      "BURN","BURP","BURR","BURY","BUSH","BUSK","BUST","BUSY","BUTT","BUZZ","BYRE","BYTE",
      "CAFE","CAFF","CAGE","CAKE","CALF","CALL","CALM","CALX","CAME","CAMP","CANE","CANT",
      "CAPE","CAPO","CARB","CARD","CARE","CARK","CARL","CARP","CART","CASE","CASH","CASK",
      "CAST","CAVE","CEDE","CELL","CENT","CERT","CESS","CHAD","CHAN","CHAP","CHAR","CHAT",
      "CHAV","CHEF","CHEM","CHEW","CHIA","CHIN","CHIP","CHIT","CHOP","CHOW","CHUB","CHUG",
      "CHUM","CIAO","CINE","CITE","CITY","CLAD","CLAM","CLAN","CLAP","CLAW","CLAY","CLEF",
      "CLEW","CLIP","CLIT","CLOD","CLOG","CLOP","CLOT","CLOY","CLUB","CLUE","COAL","COAT",
      "COAX","COCA","COCK","COCO","CODA","CODE","COED","COHO","COIF","COIL","COIN","COKE",
      "COLA","COLD","COLI","COLT","COMA","COMB","COME","COMM","COMP","CONE","CONK","CONY",
      "COOK","COOL","COOP","COOT","COPE","COPS","COPY","CORD","CORE","CORF","CORK","CORM",
      "CORN","COSH","COST","COSY","COTE","COUP","COVE","COWL","CRAB","CRAG","CRAM","CRAP",
      "CRAW","CREW","CRIB","CRON","CROP","CROW","CRUD","CRUS","CRUX","CUBE","CUFF","CULL",
      "CULM","CULT","CUNT","CURB","CURD","CURE","CURL","CURS","CURT","CUSP","CUSS","CUTE",
      "CYAN","CYMA","CYME","CYST","CZAR","DACE","DADO","DAFF","DAFT","DAGO","DAIS","DALE",
      "DAME","DAMN","DAMP","DANK","DARE","DARK","DARN","DART","DASH","DATA","DATE","DAUB",
      "DAWN","DAZE","DEAD","DEAF","DEAL","DEAN","DEAR","DEBT","DECK","DECO","DEED","DEEM",
      "DEEP","DEER","DEFT","DEFY","DEKE","DELE","DELI","DELL","DEMO","DENS","DENT","DENY",
      "DERV","DESI","DESK","DEWY","DHOW","DIAL","DIAM","DIBS","DICE","DICK","DIET","DIFF",
      "DIKE","DILL","DIME","DINE","DING","DINT","DIRE","DIRK","DIRT","DISC","DISH","DISK",
      "DISS","DITZ","DIVA","DIVE","DIVX","DOCK","DODO","DOEK","DOES","DOFF","DOGE","DOGS",
      "DOGY","DOIT","DOJO","DOLE","DOLL","DOLT","DOME","DONA","DONE","DONG","DOOM","DOOR",
      "DOPA","DOPE","DOPY","DORK","DORM","DORP","DORY","DOSE","DOSH","DOTE","DOUR","DOVE",
      "DOWN","DOXX","DOXY","DOZE","DOZY","DRAB","DRAG","DRAM","DRAT","DRAW","DRAY","DREG",
      "DREW","DREY","DRIB","DRIP","DROP","DRUB","DRUG","DRUM","DUAL","DUCK","DUCT","DUDE",
      "DUEL","DUET","DUFF","DUKE","DULL","DULY","DUMB","DUMP","DUNE","DUNG","DUNK","DUPE",
      "DUSK","DUST","DUTY","DYAD","DYKE","DYNE","DYNO","DZHO","EARL","EARN","EASE","EAST",
      "EASY","EAVE","ECHO","ECRU","EDDY","EDGE","EDGY","EDIT","EDUC","EERY","EGGY","EGIS",
      "EKKA","ELAN","ELSE","EMIR","EMIT","EMPT","ENUM","ENVY","EPIC","ERAS","ERGO","ERNE",
      "ESPY","ESSE","ETCH","ETHE","EURO","EVEN","EVIL","EXAM","EXEC","EXIT","EXON","EXPO",
      "EYOT","EYRA","EYRE","FACE","FACT","FADE","FADO","FAFF","FAIL","FAIR","FAKE","FALL",
      "FAME","FANE","FANG","FARE","FARL","FARM","FARO","FART","FASH","FAST","FATE","FAUN",
      "FAVE","FAWN","FAZE","FEAR","FEAT","FEED","FEEL","FEET","FEIS","FELL","FELT","FEND",
      "FERN","FESS","FEST","FETA","FETE","FEUD","FIAT","FIEF","FIFE","FILE","FILL","FILM",
      "FILO","FIND","FINE","FINO","FIRE","FIRM","FISC","FISH","FISK","FIST","FITS","FIVE",
      "FIZZ","FLAB","FLAG","FLAK","FLAN","FLAP","FLAT","FLAW","FLAX","FLAY","FLEA","FLEE",
      "FLEW","FLEX","FLIP","FLIT","FLOC","FLOE","FLOG","FLOP","FLOW","FLUB","FLUE","FLUX",
      "FOAL","FOAM","FOCI","FOGY","FOIE","FOIL","FOLD","FOLK","FOLL","FOND","FONT","FOOD",
      "FOOL","FOOT","FORB","FORD","FORE","FORK","FORM","FORT","FOUL","FOUR","FOWL","FOXY",
      "FRAP","FRAY","FREE","FREQ","FRET","FRIG","FRIT","FROG","FROW","FUCK","FUEL","FULL",
      "FUME","FUMY","FUND","FUNK","FURL","FURY","FUSE","FUSS","FUZZ","FYRD","GABY","GAFF",
      "GAGA","GAGE","GAIN","GAIT","GALA","GALE","GALL","GAME","GAMY","GANG","GAOL","GAPE",
      "GARB","GASH","GASP","GATE","GAUR","GAWD","GAWK","GAWP","GAZE","GEAN","GEAR","GEEK",
      "GEEZ","GELD","GENE","GENT","GENU","GEOG","GERM","GEUM","GHAT","GHEE","GIBE","GIFT",
      "GILD","GILL","GILT","GIMP","GIRD","GIRL","GIRO","GIRT","GIST","GIVE","GLAD","GLAM",
      "GLED","GLEE","GLEN","GLEY","GLIB","GLIM","GLOB","GLOM","GLOW","GLUE","GLUG","GLUM",
      "GLUT","GNAT","GNAW","GOAD","GOAL","GOAT","GOBY","GOER","GOES","GOLD","GOLF","GONE",
      "GONG","GOOD","GOOF","GOOK","GOON","GOOP","GORE","GORY","GOSH","GOTH","GOUT","GOWK",
      "GOWN","GRAB","GRAD","GRAM","GRAN","GRAV","GRAY","GREW","GREY","GRID","GRIG","GRIM",
      "GRIN","GRIP","GRIT","GROG","GROK","GROT","GROW","GRUB","GUFF","GULF","GULL","GULP",
      "GUNK","GURK","GURN","GURU","GUSH","GUST","GUTS","GYAN","GYBE","GYRE","GYRI","GYRO",
      "GZIP","HAAR","HACK","HADE","HADJ","HAEM","HAFT","HAIL","HAIR","HAJJ","HAKE","HALE",
      "HALF","HALL","HALO","HALT","HAME","HAND","HANG","HANK","HARD","HARE","HARK","HARM",
      "HARP","HART","HASH","HASP","HAST","HATE","HAUL","HAVE","HAWK","HAZE","HAZY","HEAD",
      "HEAL","HEAP","HEAR","HEAT","HEBE","HEED","HEEL","HEFT","HEIL","HEIR","HELL","HELM",
      "HELP","HEMP","HERB","HERD","HERE","HERL","HERM","HERO","HGWY","HICK","HIDE","HIGH",
      "HIKE","HILA","HILL","HILT","HIND","HINT","HIRE","HISS","HIST","HIVE","HOAR","HOAX",
      "HOBO","HOCK","HOES","HOLD","HOLE","HOLY","HOME","HOMO","HONE","HONK","HOOD","HOOF",
      "HOOK","HOOP","HOOT","HOPE","HORN","HOSE","HOSP","HOST","HOUR","HOWE","HOWL","HOYA",
      "HTML","HTTP","HUFF","HUGE","HULA","HULK","HULL","HUMP","HUNG","HUNK","HUNT","HURL",
      "HURT","HUSH","HUSK","HWYL","HYMN","HYPE","HYPO","IAMB","IBEX","IBIS","ICKY","ICON",
      "IDEA","IDLE","IDOL","IFFY","ILEA","ILEX","ILIA","IMAM","IMPI","INCA","INCH","INFO",
      "INKY","INLY","INST","IOTA","IRIS","IRON","ISLE","ITCH","ITEM","IXIA","JACK","JADE",
      "JAIL","JAMB","JAPE","JARL","JATO","JAZZ","JEAN","JEEP","JEER","JELL","JERK","JESS",
      "JEST","JIBE","JIFF","JILT","JINK","JINN","JINX","JIVE","JOCK","JOEY","JOHN","JOIN",
      "JOKE","JOKY","JOLT","JONG","JOSH","JOSS","JOWL","JPEG","JUDO","JUMP","JUNK","JURY",
      "JUST","JUTE","KADI","KAIL","KAKA","KALE","KAME","KANA","KAON","KART","KATA","KAYO",
      "KBIT","KCAL","KECK","KEEK","KEEL","KEEN","KEEP","KELP","KELT","KEMP","KENO","KEPI",
      "KERB","KERF","KERN","KETO","KHAN","KIBE","KICK","KIER","KILL","KILN","KILO","KILT",
      "KIND","KINE","KING","KINK","KINO","KIRI","KIRK","KISS","KIST","KITE","KITH","KIWI",
      "KNAG","KNAP","KNAR","KNEE","KNIT","KNOB","KNOP","KNOT","KNOW","KOAN","KOEL","KOLA",
      "KOTO","KUDU","KYLE","LACE","LACK","LACY","LADE","LADY","LAIC","LAID","LAIN","LAIR",
      "LAKE","LAMA","LAMB","LAME","LAMP","LAND","LANE","LANK","LAPS","LARD","LARK","LASE",
      "LASH","LASS","LAST","LATE","LATH","LAUD","LAVA","LAVE","LAWN","LAYS","LAZE","LAZY",
      "LEAD","LEAF","LEAK","LEAN","LEAP","LEAS","LEAT","LEEK","LEER","LEET","LEFT","LEHR",
      "LEND","LENO","LENS","LEVY","LEWD","LIAR","LICE","LICK","LIDO","LIEN","LIEU","LIFE",
      "LIFT","LIKE","LILT","LILY","LIMB","LIME","LIMN","LIMO","LIMP","LIMY","LINE","LING",
      "LINK","LINN","LINO","LINT","LINY","LION","LIRA","LIRE","LISP","LIST","LIVE","LOAD",
      "LOAF","LOAM","LOAN","LOBE","LOCH","LOCI","LOCK","LOCO","LODE","LOFT","LOGE","LOGO",
      "LOIN","LOLL","LONE","LONG","LOOK","LOOM","LOON","LOOP","LOOT","LOPE","LORD","LORE",
      "LORY","LOSE","LOSS","LOTH","LOTI","LOUD","LOUR","LOUT","LOVE","LUAU","LUBE","LUCK",
      "LUDO","LUFF","LUGE","LULL","LULU","LUMP","LUNE","LUNG","LURE","LURK","LUSH","LUST",
      "LUTE","LUXE","LYNX","LYRE","MACE","MACK","MADE","MAGE","MAGI","MAID","MAIL","MAIM",
      "MAIN","MAKE","MAKO","MALE","MALL","MALT","MAMA","MANE","MARA","MARC","MARE","MARK",
      "MARL","MART","MASC","MASH","MASK","MASS","MAST","MATE","MATT","MATY","MAUL","MAXI",
      "MAZE","MAZY","MEAD","MEAL","MEAN","MEAT","MECH","MEED","MEEK","MEET","MEIN","MELD",
      "MELT","MEME","MEMO","MEND","MENU","MEOW","MERE","MESA","MESH","MESS","METE","METH",
      "MEWL","MEWS","MICA","MICE","MICK","MIDI","MIEN","MIFF","MIKE","MILD","MILE","MILK",
      "MILL","MILT","MIME","MIND","MINE","MINI","MINK","MINT","MINX","MIRE","MIRK","MIRY",
      "MISC","MISS","MIST","MITE","MITT","MOAN","MOAT","MOCK","MODE","MOIL","MOKE","MOKO",
      "MOLE","MOLL","MOLY","MONK","MONO","MOOD","MOON","MOOR","MOOT","MOPE","MOPY","MORE",
      "MORN","MOSS","MOST","MOTE","MOTH","MOTO","MOUE","MOVE","MUCH","MUCK","MUFF","MULE",
      "MULL","MUON","MURK","MUSE","MUSH","MUSK","MUSS","MUST","MUTE","MUTT","MUZZ","MYNA",
      "MYTH","NAFF","NAIF","NAIL","NAME","NAPE","NARD","NARK","NAVE","NAVY","NEAP","NEAR",
      "NEAT","NECK","NEED","NEEP","NENE","NEON","NERD","NERK","NEST","NETT","NEWS","NEWT",
      "NEXT","NICE","NICK","NIDI","NIFF","NINE","NIPA","NOCK","NODE","NOIL","NOIR","NONE",
      "NOOB","NOOK","NOON","NORM","NOSE","NOSH","NOSY","NOTA","NOTE","NOUN","NOUS","NOVA",
      "NUDE","NUKE","NULL","NUMB","NUMP","OARS","OATH","OBEY","OBIT","OBOE","OBOL","OCKY",
      "OCTA","OGLE","OGRE","OILY","OINK","OKAY","OKRA","OMEN","OMIT","OMNI","ONCE","ONIA",
      "ONUS","ONYX","OOPS","OOZE","OOZY","OPAH","OPAL","OPEN","OPPO","OPUS","ORAL","ORCA",
      "ORGY","ORLE","OUCH","OUST","OUZO","OVAL","OVEN","OVER","OVUM","OXEN","OXER","PACA",
      "PACE","PACK","PACT","PAGE","PAID","PAIL","PAIN","PAIR","PALE","PALL","PALM","PALP",
      "PANE","PANG","PANT","PAPA","PARA","PARE","PARK","PARS","PART","PASH","PASS","PAST",
      "PATE","PATH","PAUA","PAVE","PAWL","PAWN","PAYS","PEAK","PEAL","PEAN","PEAR","PEAT",
      "PECK","PEEK","PEEL","PEEN","PEEP","PEER","PEKE","PELE","PELF","PELL","PELT","PEND",
      "PENS","PENT","PEON","PEPO","PERI","PERK","PERM","PERT","PERV","PESO","PEST","PHEW",
      "PHON","PHYS","PICA","PICK","PICO","PIKE","PILE","PILL","PIMP","PINA","PINE","PING",
      "PINK","PINS","PINT","PINY","PION","PIPA","PIPE","PIRK","PISH","PISS","PITH","PITY",
      "PLAN","PLAT","PLAY","PLEA","PLEB","PLOD","PLOP","PLOT","PLOY","PLUG","PLUM","PLUS",
      "POCK","POEM","POET","POGO","POKE","POKY","POLE","POLL","POLO","POMP","POND","PONE",
      "PONG","PONS","PONY","POOF","POOH","POOL","POON","POOP","POOR","POPE","PORE","PORK",
      "PORN","PORT","POSE","POSH","POST","POSY","POUR","POUT","POXY","PRAM","PRAT","PRAY",
      "PREF","PREM","PREP","PREY","PRIG","PRIM","PRIS","PROA","PROD","PROF","PROG","PROM",
      "PROP","PROS","PROW","PSST","PUCE","PUCK","PUFF","PUJA","PUKE","PUKU","PULE","PULL",
      "PULP","PUMA","PUMP","PUNA","PUNK","PUNT","PUNY","PUPA","PURE","PURI","PURL","PURR",
      "PUSH","PUSS","PUTS","PUTT","PYRE","PYRO","QUAD","QUAY","QUID","QUIN","QUIP","QUIT",
      "QUIZ","QUOD","RABI","RACE","RACK","RACY","RAFF","RAFT","RAGA","RAGE","RAID","RAIL",
      "RAIN","RAJA","RAKE","RALE","RAMI","RAMP","RAND","RANG","RANI","RANK","RANT","RAPE",
      "RAPT","RARE","RASE","RASH","RASP","RATA","RATE","RAVE","RAZE","READ","REAL","REAM",
      "REAP","REAR","RECK","REDO","REED","REEF","REEK","REEL","REIN","RELY","REND","RENT",
      "REPO","REST","RHEA","RIAL","RICE","RICH","RICK","RIDE","RIFE","RIFF","RIFT","RILE",
      "RILL","RIME","RIND","RING","RINK","RIOT","RIPE","RISE","RISK","RITE","RIVE","ROAD",
      "ROAM","ROAN","ROAR","ROBE","ROCK","RODE","ROIL","ROLE","ROLL","ROMP","ROOD","ROOF",
      "ROOK","ROOM","ROOT","ROPE","ROSE","ROSY","ROTA","ROTE","ROUT","ROVE","RUBY","RUCK",
      "RUDE","RUFF","RUIN","RULE","RUMP","RUNE","RUNG","RUNT","RUSA","RUSE","RUSH","RUSK",
      "RUST","SACK","SAFE","SAGA","SAGE","SAGO","SAID","SAIL","SAKE","SAKI","SALE","SALT",
      "SAND","SANE","SARI","SARK","SASH","SATE","SATI","SAVE","SCAB","SCAD","SCAM","SCAN",
      "SCAR","SCAT","SCOT","SCRY","SCUD","SCUM","SEAL","SEAM","SEAR","SEAT","SECT","SEED",
      "SEEK","SEEM","SEEN","SEEP","SEER","SEES","SEGO","SELF","SELL","SEMI","SEND","SENT",
      "SEPT","SERA","SERE","SERF","SETA","SETS","SETT","SEXT","SEXY","SHAD","SHAG","SHAH",
      "SHAM","SHAT","SHED","SHIM","SHIN","SHIP","SHIT","SHOD","SHOE","SHOO","SHOP","SHOT",
      "SHOW","SHUN","SHUT","SICE","SICK","SIDE","SIFT","SIGH","SIGN","SIKA","SILK","SILL",
      "SILO","SILT","SINE","SING","SINH","SINK","SIPE","SIRE","SITE","SITU","SIZE","SKEP",
      "SKEW","SKID","SKIM","SKIN","SKIP","SKIT","SKUA","SLAB","SLAG","SLAM","SLAP","SLAT",
      "SLAY","SLED","SLEW","SLEY","SLID","SLIM","SLIP","SLIT","SLOB","SLOE","SLOG","SLOP",
      "SLOT","SLOW","SLUB","SLUE","SLUG","SLUM","SLUR","SLUT","SMEW","SMOG","SMUG","SMUT",
      "SNAG","SNAP","SNIB","SNIP","SNOB","SNOG","SNOT","SNOW","SNUB","SNUG","SOAK","SOAP",
      "SOAR","SOCK","SODA","SOFA","SOFT","SOIL","SOKE","SOLD","SOLE","SOLO","SOMA","SOME",
      "SONE","SONG","SOOL","SOON","SOOT","SOPH","SORA","SORB","SORE","SORI","SORT","SOUK",
      "SOUL","SOUM","SOUP","SOUR","SOUS","SOYA","SPAE","SPAM","SPAN","SPAR","SPAS","SPAT",
      "SPAY","SPEC","SPEW","SPIC","SPIN","SPIT","SPIV","SPOT","SPUD","SPUR","STAB","STAG",
      "STAR","STAT","STAY","STEM","STEP","STET","STEW","STIR","STOP","STOW","STUB","STUD",
      "STUM","STUN","SUCK","SUDS","SUET","SUIT","SULK","SUMO","SUMP","SUNG","SURA","SURD",
      "SURE","SURF","SUSS","SWAB","SWAG","SWAN","SWAP","SWAT","SWAY","SWIG","SWIM","SWOT",
      "SYNC","TAAL","TACK","TACO","TACT","TAIL","TAKE","TALC","TALE","TALK","TALL","TAME",
      "TAMP","TANG","TANK","TANS","TAPE","TARE","TARN","TARO","TART","TASK","TASS","TAUT",
      "TAXA","TAXI","TEAK","TEAL","TEAM","TEAR","TEAS","TEAT","TECH","TEEM","TEEN","TELL",
      "TEMP","TEND","TENS","TENT","TERM","TERN","TEST","TEXT","THAT","THAW","THEM","THIN",
      "THUD","THUG","THUS","TICK","TIDE","TIDY","TIED","TIER","TIES","TIFF","TIKE","TIKI",
      "TILE","TILL","TILT","TIME","TINE","TING","TINT","TINY","TIPS","TIRE","TIRO","TITI",
      "TIZZ","TOAD","TOCK","TOFF","TOFU","TOGA","TOIL","TOKE","TOLD","TOLL","TOMB","TOME",
      "TONE","TONG","TONK","TOOK","TOOL","TOON","TOOT","TOPE","TORE","TORR","TORT","TOSH",
      "TOSS","TOTE","TOUR","TOUT","TOWN","TRAD","TRAM","TRAP","TRAY","TREE","TREK","TREY",
      "TRIG","TRIM","TRIO","TRIP","TROD","TROT","TRUE","TRUG","TSAR","TUBA","TUBE","TUCK",
      "TUFT","TUNA","TUNE","TURD","TURF","TURN","TUSH","TUSK","TUTU","TWAT","TWEE","TWIG",
      "TWIN","TWIT","TYKE","TYPE","TYPO","TYRE","TYRO","TZAR","UDAL","UGLY","ULNA","UMBO",
      "UNCO","UNDO","UNIT","UPON","UREA","URGE","URUS","USED","USER","UTAN","UUCP","VAGI",
      "VAIL","VAIN","VALE","VAMP","VANE","VAPE","VARY","VASE","VAST","VEAL","VEER","VEIL",
      "VEIN","VELA","VELD","VEND","VENT","VERB","VERT","VERY","VEST","VETO","VIAL","VIBE",
      "VICE","VIEW","VILE","VINE","VINO","VIOL","VISA","VITA","VIVA","VLEI","VOID","VOLE",
      "VOLT","VOTE","VRIL","WACK","WADE","WAFT","WAGE","WAIF","WAIL","WAIN","WAIT","WAKA",
      "WAKE","WALE","WALK","WALL","WAND","WANE","WANK","WANT","WARD","WARE","WARM","WARN",
      "WARP","WART","WARY","WASH","WASP","WAST","WATT","WAVE","WAVY","WAXY","WEAK","WEAL",
      "WEAN","WEAR","WEDS","WEED","WEEK","WEEP","WEFT","WEIR","WELD","WELL","WELT","WEND",
      "WENT","WEST","WHAM","WHAT","WHET","WHEY","WHIM","WHIP","WHIR","WHIT","WHOP","WICK",
      "WIDE","WIFE","WIKI","WILD","WILE","WILL","WILT","WILY","WIMP","WIND","WINE","WING",
      "WINK","WINO","WIPE","WIRE","WIRY","WISE","WISH","WISP","WITH","WITS","WOAD","WOLD",
      "WOLF","WOMB","WONT","WOOD","WOOF","WOOL","WORD","WORE","WORK","WORM","WORN","WORT",
      "WOVE","WRAP","WREN","WRIT","WUSS","XLSX","YACK","YANG","YANK","YARD","YARN","YAWL",
      "YAWN","YAWP","YEAR","YELL","YELP","YETI","YOGA","YOGI","YOKE","YOLK","YONI","YORE",
      "YORK","YOUR","YOWL","YUAN","YUCK","YUGA","YURT","YUZU","ZANY","ZEAL","ZEBU","ZEIN",
      "ZERO","ZEST","ZETA","ZINC","ZINE","ZING","ZIPX","ZITI","ZONE","ZOOM","ZULU"
    ];

    const WORD_LENGTH = 4;
    const MAX_GUESSES = 6;

    let secretWord = "";
    let currentRow = 0;
    let currentCol = 0;
    let isGameOver = false;

    // Activity logging
    let sessionId = null;
    let guessStartTime = null;
    let guesses = [];
    const GAME_NAME = 'fourdle';

    const boardEl = document.getElementById("board");
    const messageEl = document.getElementById("message");
    const keyboardEl = document.getElementById("keyboard");
    const newGameBtn = document.getElementById("new-game");

    function pickSecretWord() {
      const idx = Math.floor(Math.random() * WORD_LIST.length);
      return WORD_LIST[idx];
    }

    function createBoard() {
      boardEl.innerHTML = "";
      for (let row = 0; row < MAX_GUESSES; row++) {
        for (let col = 0; col < WORD_LENGTH; col++) {
          const tile = document.createElement("div");
          tile.className = "tile";
          tile.dataset.row = row;
          tile.dataset.col = col;
          boardEl.appendChild(tile);
        }
      }
    }

    function createKeyboard() {
      keyboardEl.innerHTML = "";
      const rows = [
        "QWERTYUIOP",
        "ASDFGHJKL",
        "ZXCVBNM"
      ];

      // First row
      for (const ch of rows[0]) {
        keyboardEl.appendChild(makeKeyButton(ch));
      }

      // Second row (offset by one empty cell for spacing)
      const spacer = document.createElement("div");
      spacer.style.visibility = "hidden";
      keyboardEl.appendChild(spacer);
      for (const ch of rows[1]) {
        keyboardEl.appendChild(makeKeyButton(ch));
      }

      // Third row with ENTER and DELETE
      const enterKey = makeKeyButton("ENTER");
      enterKey.classList.add("large");
      keyboardEl.appendChild(enterKey);

      for (const ch of rows[2]) {
        keyboardEl.appendChild(makeKeyButton(ch));
      }

      const delKey = makeKeyButton("DEL");
      delKey.classList.add("large");
      keyboardEl.appendChild(delKey);
    }

    function makeKeyButton(label) {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "key";
      btn.textContent = label === "DEL" ? "‚å´" : label;
      btn.dataset.key = label;
      btn.addEventListener("click", () => handleKey(label));
      return btn;
    }

    function showMessage(text) {
      messageEl.textContent = text;
    }

    function getTile(row, col) {
      return boardEl.querySelector(`.tile[data-row="${row}"][data-col="${col}"]`);
    }

    function updateKeyboardColours(letterStatuses) {
      // letterStatuses: map from letter to status ("correct", "present", "absent")
      for (const [letter, status] of Object.entries(letterStatuses)) {
        const keyBtn = keyboardEl.querySelector(`.key[data-key="${letter}"]`);
        if (!keyBtn) continue;

        // Upgrade logic: correct > present > absent
        const current = keyBtn.dataset.status;
        if (current === "correct") continue;
        if (current === "present" && status === "absent") continue;

        keyBtn.dataset.status = status;
        keyBtn.classList.remove("correct", "present", "absent");
        keyBtn.classList.add(status);
      }
    }

    function handleKey(key) {
      if (isGameOver) return;

      if (key === "ENTER") {
        submitGuess();
      } else if (key === "DEL" || key === "Backspace") {
        deleteLetter();
      } else if (/^[A-Z]$/.test(key)) {
        addLetter(key);
      }
    }

    function addLetter(letter) {
      if (currentCol >= WORD_LENGTH) return;
      const tile = getTile(currentRow, currentCol);
      tile.textContent = letter;
      tile.classList.add("filled");
      currentCol += 1;
    }

    function deleteLetter() {
      if (currentCol === 0) return;
      currentCol -= 1;
      const tile = getTile(currentRow, currentCol);
      tile.textContent = "";
      tile.classList.remove("filled");
    }

    function submitGuess() {
      if (currentCol < WORD_LENGTH) {
        showMessage("Not enough letters");
        return;
      }

      let guess = "";
      for (let col = 0; col < WORD_LENGTH; col++) {
        guess += getTile(currentRow, col).textContent;
      }
      guess = guess.toUpperCase();

      if (!WORD_LIST.includes(guess)) {
        showMessage("Word not in list");
        return;
      }

      // Evaluate guess
      const evaluation = evaluateGuess(guess, secretWord);
      const letterStatuses = {};

      for (let col = 0; col < WORD_LENGTH; col++) {
        const tile = getTile(currentRow, col);
        const status = evaluation[col];
        tile.classList.add(status, "flip");
        const letter = guess[col];

        // Track best status for keyboard
        const current = letterStatuses[letter];
        if (current === "correct") {
          // already the best
        } else if (current === "present" && status === "absent") {
          // ignore downgrade
        } else {
          letterStatuses[letter] = status;
        }
      }

      updateKeyboardColours(letterStatuses);
      showWordInfo(guess);

      const isCorrect = guess === secretWord;
      
      // Log the guess
      const guessData = {
        guess: guess,
        answer: secretWord,
        correct: isCorrect,
        reactionTime: guessStartTime ? Date.now() - guessStartTime : 0,
        guessNumber: currentRow + 1
      };
      guesses.push(guessData);
      ActivityLogger.log(sessionId, 'guess', guessData);

      if (isCorrect) {
        showMessage("Splendid! You've got it.");
        isGameOver = true;
        // Log round end
        ActivityLogger.log(sessionId, 'round_end', {
          won: true,
          answer: secretWord,
          guessCount: currentRow + 1,
          guesses: guesses
        });
        return;
      }

      currentRow += 1;
      currentCol = 0;
      guessStartTime = Date.now(); // Reset timer for next guess

      if (currentRow >= MAX_GUESSES) {
        showMessage(`Unlucky ‚Äì the word was ${secretWord}`);
        isGameOver = true;
        // Log round end
        ActivityLogger.log(sessionId, 'round_end', {
          won: false,
          answer: secretWord,
          guessCount: MAX_GUESSES,
          guesses: guesses
        });
      } else {
        showMessage("");
      }
    }

    function evaluateGuess(guess, secret) {
      const result = Array(WORD_LENGTH).fill("absent");
      const secretLetters = secret.split("");
      const guessLetters = guess.split("");

      // First pass: correct positions
      const letterCounts = {};
      for (let i = 0; i < WORD_LENGTH; i++) {
        const s = secretLetters[i];
        letterCounts[s] = (letterCounts[s] || 0) + 1;
      }

      for (let i = 0; i < WORD_LENGTH; i++) {
        if (guessLetters[i] === secretLetters[i]) {
          result[i] = "correct";
          letterCounts[guessLetters[i]] -= 1;
        }
      }

      // Second pass: present but misplaced
      for (let i = 0; i < WORD_LENGTH; i++) {
        if (result[i] === "correct") continue;
        const letter = guessLetters[i];
        if (letterCounts[letter] > 0) {
          result[i] = "present";
          letterCounts[letter] -= 1;
        }
      }

      return result;
    }


    // Word definitions data
    let wordData = {};
    
    // Load word definitions
    fetch('word-data/words4.json')
      .then(r => r.json())
      .then(data => { wordData = data; console.log('Loaded', Object.keys(data).length, 'word definitions'); })
      .catch(e => console.log('Could not load word data:', e));

    const wordInfoEl = document.getElementById("word-info");

    function showWordInfo(word) {
      const info = wordData[word];
      if (!info) {
        wordInfoEl.innerHTML = '';
        return;
      }
      
      let html = '<div class="word-title">' + word + '</div>';
      if (info.d) {
        html += '<div class="definition">' + escapeHtml(info.d) + '</div>';
      }
      if (info.e) {
        html += '<div class="etymology">' + escapeHtml(info.e) + '</div>';
      }
      wordInfoEl.innerHTML = html;
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function resetGame() {
      secretWord = pickSecretWord();
      currentRow = 0;
      currentCol = 0;
      isGameOver = false;
      createBoard();
      createKeyboard();
      showMessage("New game ‚Äì good luck!");
      wordInfoEl.innerHTML = '';
      
      // Reset logging for new game
      guesses = [];
      // Start new logging session
      sessionId = ActivityLogger.startSession(GAME_NAME, {
        wordLength: WORD_LENGTH,
        maxGuesses: MAX_GUESSES
      });
      guessStartTime = Date.now();
    }

    // Physical keyboard support
    document.addEventListener("keydown", (event) => {
      const key = event.key;
      if (key === "Enter") {
        handleKey("ENTER");
      } else if (key === "Backspace" || key === "Delete") {
        handleKey("Backspace");
      } else if (key.toLowerCase() === "n" && isGameOver) {
        resetGame();
      } else if (key.toLowerCase() === "h" && isGameOver) {
        window.location.href = "index.html";
      } else {
        const upper = key.toUpperCase();
        if (/^[A-Z]$/.test(upper)) {
          handleKey(upper);
        }
      }
    });

    newGameBtn.addEventListener("click", resetGame);

    // Initialise
    resetGame();
  </script>
</body>
</html>
